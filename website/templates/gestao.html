<!-- website/templates/gestao.html -->
{% extends "base.html" %}
{% block title %}Gestão – Cutelaria{% endblock %}

{% block content %}
<h2>Painel de Gestão</h2>

<ul class="nav nav-tabs" id="gestaoTabs" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="tab-mp" data-toggle="tab" href="#mp" role="tab">Matéria-Prima</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="tab-pa" data-toggle="tab" href="#pa" role="tab">Produtos Acabados</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="tab-pv" data-toggle="tab" href="#pv" role="tab">Pedidos / Vendas</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="tab-os" data-toggle="tab" href="#os" role="tab">Ordem de Serviço</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="tab-reposicao" data-toggle="tab" href="#reposicao" role="tab">Reposição</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="tab-alertas" data-toggle="tab" href="#alertas" role="tab">Alertas & Indicadores</a>
  </li>
</ul>

<div class="tab-content mt-3">

  <!-- Matéria-Prima -->
  <div class="tab-pane fade show active" id="mp" role="tabpanel">
    <a href="{{ url_for('views.nova_materia_prima') }}" class="btn btn-sm btn-success mb-2">
      + Matéria-Prima
    </a>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>Código</th>
          <th>Tipo</th>
          <th>Unidade</th>
          <th>Qtd. Estoque</th>
          <th>Ponto Rep.</th>
          <th>Fornecedor</th>
          <th>Últ. Entrada</th>
          <th>Obs</th>
        </tr>
      </thead>
      <tbody>
        {% for m in materias %}
        <tr>
          <td>{{ m.codigo_item }}</td>
          <td>{{ m.tipo_material }}</td>
          <td>{{ m.unidade }}</td>
          <td>{{ m.quantidade_estoque }}</td>
          <td>{{ m.ponto_reposicao }}</td>
          <td>{{ m.fornecedor or '-' }}</td>
          <td>{{ m.data_ultima_entrada.strftime('%d/%m/%Y') }}</td>
          <td>{{ m.observacoes or '-' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Produtos Acabados -->
  <div class="tab-pane fade" id="pa" role="tabpanel">
    <a href="{{ url_for('views.novo_produto_acabado') }}" class="btn btn-sm btn-success mb-2">
      + Produto Acabado
    </a>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>Código</th>
          <th>Tipo</th>
          <th>Lâmina</th>
          <th>Cabo</th>
          <th>Disponível</th>
          <th>Reservada</th>
          <th>Vendida Mês</th>
          <th>Obs</th>
        </tr>
      </thead>
      <tbody>
        {% for p in produtos %}
        <tr>
          <td>{{ p.codigo_faca }}</td>
          <td>{{ p.tipo }}</td>
          <td>{{ p.material_lamina }}</td>
          <td>{{ p.material_cabo }}</td>
          <td>{{ p.quantidade_disponivel }}</td>
          <td>{{ p.quantidade_reservada }}</td>
          <td>{{ p.quantidade_vendida_mes }}</td>
          <td>{{ p.observacoes or '-' }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pedidos / Vendas -->
  <div class="tab-pane fade" id="pv" role="tabpanel">
    <a href="{{ url_for('views.novo_pedido_venda') }}" class="btn btn-sm btn-success mb-2">
      + Pedido / Venda
    </a>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>Pedido</th>
          <th>Cliente</th>
          <th>Produto(s)</th>
<<<<<<< HEAD
=======
          <th>Qtd.</th>
>>>>>>> e304e52 (commit ajuste flask)
          <th>Personalização</th>
          <th>Data</th>
          <th>Status</th>
          <th>Prev. Entrega</th>
          <th>Valor</th>
          <th>Obs</th>
<<<<<<< HEAD
=======
          <th>Ações</th>
>>>>>>> e304e52 (commit ajuste flask)
        </tr>
      </thead>
      <tbody>
        {% for ped in pedidos %}
        <tr>
          <td>{{ ped.numero_pedido }}</td>
          <td>{{ ped.nome_cliente }}</td>
          <td>{{ ped.produtos_solicitados }}</td>
<<<<<<< HEAD
=======
          <td>{{ ped.produtos_solicitados.split('×')[-1] | trim }}</td>
>>>>>>> e304e52 (commit ajuste flask)
          <td>{{ 'Sim' if ped.personalizacao else 'Não' }}</td>
          <td>{{ ped.data_pedido.strftime('%d/%m/%Y') }}</td>
          <td>{{ ped.status }}</td>
          <td>{{ ped.data_prevista_entrega.strftime('%d/%m/%Y') if ped.data_prevista_entrega else '-' }}</td>
          <td>{{ ped.valor_pedido }}</td>
          <td>{{ ped.observacoes or '-' }}</td>
<<<<<<< HEAD
=======
          <td>
            <a href="{{ url_for('views.edit_pedido_venda', ped_id=ped.id) }}" class="btn btn-sm btn-secondary">Editar</a>
          </td>
>>>>>>> e304e52 (commit ajuste flask)
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Ordem de Serviço -->
  <div class="tab-pane fade" id="os" role="tabpanel">
    <a href="{{ url_for('views.nova_ordem_servico') }}" class="btn btn-sm btn-success mb-2">
      + Ordem de Serviço
    </a>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>OS</th>
          <th>Produto</th>
          <th>Qtd</th>
          <th>Mat. Necessários</th>
          <th>Início</th>
          <th>Prev. Conclusão</th>
          <th>Resp.</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for os in ordens %}
        <tr>
          <td>{{ os.numero_os }}</td>
          <td>{{ os.produto.codigo_faca }}</td>
          <td>{{ os.quantidade }}</td>
          <td>{{ os.materiais_necessarios }}</td>
          <td>{{ os.data_inicio_producao.strftime('%d/%m/%Y') }}</td>
          <td>{{ os.data_prevista_conclusao.strftime('%d/%m/%Y') if os.data_prevista_conclusao else '-' }}</td>
          <td>{{ os.responsavel }}</td>
          <td>{{ os.status }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Reposição de Matéria-Prima -->
  <div class="tab-pane fade" id="reposicao" role="tabpanel">
<<<<<<< HEAD
    <a href="{{ url_for('views.nova_reposicao_materia_prima') }}"
       class="btn btn-sm btn-success mb-2">
=======
    <a href="{{ url_for('views.nova_reposicao_materia_prima') }}" class="btn btn-sm btn-success mb-2">
>>>>>>> e304e52 (commit ajuste flask)
      + Requisição de Reposição
    </a>
    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>ID</th>
          <th>Matéria-Prima</th>
          <th>Qtd. Reposição</th>
          <th>Solicitação</th>
          <th>Previsão</th>
          <th>Fornecedor</th>
          <th>Status</th>
          <th>Obs</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for r in reposicoes %}
        <tr>
          <td>{{ r.id }}</td>
          <td>{{ r.materia.codigo_item }}</td>
          <td>{{ r.quantidade_reposicao }}</td>
          <td>{{ r.data_solicitacao.strftime('%d/%m/%Y') }}</td>
          <td>{{ r.data_previsao_reposicao.strftime('%d/%m/%Y') if r.data_previsao_reposicao else '-' }}</td>
          <td>{{ r.fornecedor or '-' }}</td>
          <td>{{ r.status }}</td>
          <td>{{ r.observacoes or '-' }}</td>
          <td>
<<<<<<< HEAD
            <a href="{{ url_for('views.edit_reposicao_materia_prima', rp_id=r.id) }}"
               class="btn btn-sm btn-secondary">
              Editar
            </a>
=======
            <a href="{{ url_for('views.edit_reposicao_materia_prima', rp_id=r.id) }}" class="btn btn-sm btn-secondary">Editar</a>
>>>>>>> e304e52 (commit ajuste flask)
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Alertas & Indicadores -->
  <div class="tab-pane fade" id="alertas" role="tabpanel">
    <h4>Alertas & Indicadores</h4>
    <ul class="list-group">
      <li class="list-group-item">
<<<<<<< HEAD
        Itens abaixo do mínimo:
        <strong>{{ itens_baixo_estoque|length }}</strong>
      </li>
      <li class="list-group-item">
        Pedidos vencidos:
        <strong>{{ pedidos_vencidos|length }}</strong>
      </li>
      <li class="list-group-item">
        Produções em atraso:
        <strong>{{ producoes_atrasadas|length }}</strong>
      </li>
      <li class="list-group-item">
        Pedidos em andamento:
        <strong>{{ total_pedidos_andamento }}</strong>
      </li>
      <li class="list-group-item">
        Vendas do mês:
        <strong>R$ {{ vendas_mes|round(2) }}</strong>
=======
        Itens abaixo do mínimo: <strong>{{ itens_baixo_estoque|length }}</strong>
      </li>
      <li class="list-group-item">
        Pedidos vencidos: <strong>{{ pedidos_vencidos|length }}</strong>
      </li>
      <li class="list-group-item">
        Produções em atraso: <strong>{{ producoes_atrasadas|length }}</strong>
      </li>
      <li class="list-group-item">
        Pedidos em andamento: <strong>{{ total_pedidos_andamento }}</strong>
      </li>
      <li class="list-group-item">
        Vendas do mês: <strong>R$ {{ vendas_mes|round(2) }}</strong>
>>>>>>> e304e52 (commit ajuste flask)
      </li>
    </ul>
  </div>

</div>

<script>
  $('#gestaoTabs a').on('click', function (e) {
    e.preventDefault();
    $(this).tab('show');
  });
</script>
{% endblock %}
